<ion-content>
  <div class="buttons-dekstop">

    <div class="buttons-desktop-wrapper">

      <div class="btnsWrapperBack">
        <ion-button disabled="true" class="backButton buttonsNavigate" *ngIf="stepCurrency == stepStart"  (click)="stepPrev()"><ion-icon name="chevron-back" slot="start"></ion-icon>Назад</ion-button>
        <ion-button class="backButton buttonsNavigate" *ngIf="stepCurrency !== stepStart"  (click)="stepPrev()"><ion-icon name="chevron-back" slot="start"></ion-icon>Назад</ion-button>
      </div>


      <div class="btnsWrapper btnsWrapperNext">
        <ion-button class="buttonsNavigate" [disabled]="detectedDataInvalid()" *ngIf="stepCurrency !== steps" [hidden]="stepCurrency === steps-1"  (click)="stepNext()">Далее <ion-icon name="chevron-forward" slot="end"></ion-icon></ion-button>
        <ion-button class="buttonsNavigate" (click)="onSubmit()" *ngIf="stepCurrency === steps-1" type="submit" [disabled]="detectedDataInvalid()"><ion-icon name="checkmark-done-outline" slot="start"></ion-icon>Готово</ion-button>
      </div>

    </div>
  </div>
  
  <ion-grid class="main">
    <form class="mainChild" [formGroup]="createEventForm" (submit)="onSubmit()" enctype="multipart/form-data"> 
      
      <ion-column class="mainLabelAndBar">
        <div class="ion-text-start">
          <h3 [hidden]="stepCurrency != 0" class="mt-0 mainLabelAndBarText">Тип мероприятия</h3>
          <h3 [hidden]="stepCurrency != 1" class="mt-0 mainLabelAndBarText">Название мероприятия</h3>
          <h3 [hidden]="stepCurrency != 2" class="mt-0 mainLabelAndBarText">О мероприятие</h3>
          <h3 [hidden]="stepCurrency != 3" class="mt-0 mainLabelAndBarText">Место проведения</h3>
          <h3 [hidden]="stepCurrency != 4" class="mt-0 mainLabelAndBarText">Цена и материалы</h3>
         
        </div>

        <!-- кнопки шагов -->

        <ion-column>

        

          <ion-col size-lg="4" size-md="8" size-xs="12">
            <div class="stepper-progress">
              <ion-column class="stepsButtonsMain ">

                

                  <div *ngFor="let step of [].constructor(steps); let i = index" class=" " >
                    <div class="buttonWraper">


                      <ion-button  *ngIf="stepCurrency === i" (click)="goToStep(i)" class="buttonBarClicked animated fadeIn">
                          {{ i + 1 }}
                        </ion-button>

                        <ion-button *ngIf="!stepIsValid(i) && stepCurrency !== i" (click)="goToStep(i)" class="buttonBarDanger animated fadeIn">
                          {{ i + 1 }}
                        </ion-button>

                        <ion-button *ngIf="!(stepCurrency === i) && stepIsValid(i) && stepCurrency !== i" (click)="goToStep(i)" class="buttonBarLight animated fadeIn">
                          {{ i + 1 }}
                        </ion-button>


                    </div>  
                  </div>


                 

              </ion-column>
              
            </div>
           
          </ion-col>
        </ion-column>


      </ion-column>



     
      
        <!-- шаг 1 -->


        <ng-container *ngIf="!typesLoaded">
          <ng-container *ngFor="let key of [1,2,3,4,5,6,7,8,9,10]">
            <ion-item>
              <ion-avatar>
                <ion-skeleton-text [animated]="true"></ion-skeleton-text>
              </ion-avatar>
              <ion-label class="ion-padding-start">
                <ion-skeleton-text [animated]="true"></ion-skeleton-text>
              </ion-label>
            </ion-item>
          </ng-container>
        </ng-container> 
     
        <ion-row  [hidden]="stepCurrency !== 0" class="ion-justify-content-center">
          <ion-col size-lg="8" size-md="8" size-xs="12" *ngIf="stepCurrency === 0" @fade>
          <ion-list>
            <ion-radio-group formControlName="type" (ionChange)="selectedType($event)" [value]="typeSelected" required>
              <ion-list-header>
                <ion-label *ngIf="typesLoaded">Выберите тип мероприятия</ion-label>
              </ion-list-header>
              <app-sight-type [types]="types" [typesLoaded] = "typesLoaded" [isSight]="false"></app-sight-type>
              
            </ion-radio-group>
          </ion-list>
          </ion-col>
          <!-- <ion-label>{{ count }}</ion-label>
          <app-types (buttonClick)="onAdd($event)"></app-types> -->
        </ion-row>
      

      <!-- шаг 2 -->
      <ion-row  [hidden]="stepCurrency !== 1" class="ion-justify-content-center">
        
        <ion-col *ngIf="stepCurrency === 1" @fade>

          <ion-column class="stepSecond">     

           

            <div>
              <ion-column class="nameParrent">
                <div>
                  <ion-item style="max-width: 600px;" fill="outline"> 
                    <ion-label position="floating">Название мероприятия</ion-label>
                    <ion-icon name="text-outline" slot="start" size="small" color="primary"></ion-icon>
                    <ion-input fill="solid" style="max-width: 300px;" size="small" class="nameEvent" formControlName="name" type="text" name="name" required></ion-input>                  
                  </ion-item>
    
                </div>
  
                
              </ion-column>


              <ion-row>
           
                <ion-column class="organizaterParrent">
                  
                  <ion-item class="organizerMain"
                    fill="outline"
                  >
                    <ion-label position="floating">Организатор мероприятия</ion-label>
                    <ion-icon name="text-outline" slot="start"  size="small" color="primary"></ion-icon>
                    <ion-input formControlName="sponsor"  type="text" name="sponsor" required></ion-input>
                  </ion-item>
                  
    
                 
                </ion-column>
                
                <ion-column>
    
                
    
                </ion-column>
                
               
                
    
               
    
              </ion-row>
              <div *ngIf="createEventForm.controls['sponsor'].invalid && createEventForm.controls['sponsor'].dirty"  class="validation">
                <ion-note *ngIf="!createEventForm.controls['sponsor'].hasError('minLength')" color="danger">поле "Организатор мероприятия" должно содержать минимум 3 символа</ion-note>
              </div>
              <ion-col *ngIf="createEventForm.controls['name'].invalid && createEventForm.controls['name'].dirty"  class="validation">
                <ion-note *ngIf="!createEventForm.controls['name'].hasError('minLength')" color="danger">Название мероприятия должно содержать минимум 3 символа</ion-note>
              </ion-col>
            </div>            

           
            
          
          
           
            <!-- Организатор -->
         
        

          </ion-column>

       
         
        </ion-col>
      </ion-row>
      
      <!-- шаг 3 -->

      <ion-row style="display: flex; justify-content: center;"  [hidden]="stepCurrency !== 2">


        <ion-modal class="modal" backdropDismiss="false" [isOpen] ="openModalGroupValue" [canDismiss]="openModalGroupValue">

          <ng-template>

            <ion-content>



                <ion-list>
      
                    <ion-list-header>
                      <ion-label class="modalLabel">Выберите группу, из которой следует загрузить посты</ion-label>
                    </ion-list-header>  

                    <ion-radio-group *ngIf="vkGroups" (ionChange)="selectedVkGroup($event); openModalPost($event); saveChangeId()" [allowEmptySelection]="true" [value]="vkGroupSelected">
                      <ng-container>
                        <ion-item>
                          <ion-avatar>
                            <img alt="ava" src="/assets/icons/favicon.png" />
                          </ion-avatar>
                          <ion-label class="ion-padding-start">Моя страница</ion-label>
                          <ion-radio slot="end" value="{{ user.social_account.provider_id }}"></ion-radio>
                        </ion-item>
                      </ng-container>
                      <ng-container *ngFor="let group of vkGroups">
                        

                          <ion-item>
                            <ion-avatar>
                              <img alt="ava" src="{{ group.photo_50 }}" />
                            </ion-avatar>
                            <ion-label class="ion-padding-start">{{ group.name }}</ion-label>

                            <ion-radio  slot="end" value="-{{ group.id }}"></ion-radio>
                          </ion-item>

                          <div>
                            
                          </div>
                      </ng-container>
                    </ion-radio-group>
                    <!-- Грузим чужие посты из вк, временное решение -->
                    <!-- <ng-container>
                      <ion-item>
                        <ion-label class="ion-padding-start">
                          <ion-input label="Url input" type="text" placeholder="URL группы" (ionChange)="onFocusPlace($event)"></ion-input>
                        </ion-label>
                          <ion-button  (click)="setVkPostsByGroupURL();  stepNext();">Загрузить URL</ion-button>
                      </ion-item>
                    </ng-container> -->
                    
                </ion-list>
       
               

                <ion-button class="modalBtnBottom" (click)="closeAllModals()">
                  Закрыть
                </ion-button>


            </ion-content>

          </ng-template>


        </ion-modal>


        <ion-modal class="modal"  backdropDismiss="false" [isOpen]="openModalPostValue" [canDismiss]="openModalPostValue">

                  <ng-template>
                      <ion-content>
                        <ion-button class="backToGroupBtn" (click)="closeModalPost()">
                          Вернутся к выбору группы
                        </ion-button>

                        <ion-list-header>
                          <ion-label>Выберите пост, из которого следует загрузить текст и фото (загружены последние 10 постов). Если вы выберите пост, то шаги 4 и 5 (описание мероприятия и загрузка фото) будут скрыты, так как они автоматически заполнятся из поста.</ion-label>
                        </ion-list-header>

                        <ion-button class="modalBtnBottom" (click)="closeAllModals()">
                          Закрыть
                        </ion-button>
                        
                        <div *ngIf="vkGroupPosts; else notSelectedGroup">              
                          <!-- Скелетна анимация -->
                          <ng-container *ngIf="!vkGroupPostsLoaded">
                            <ng-container *ngFor="let key of [1,2]">
                              <ion-card>
                                
                                <ion-item class="ion-margin-end">
                                  <ion-avatar slot="start">
                                    <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                                  </ion-avatar>
                                  <ion-label>
                                    <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                                  </ion-label>
                                </ion-item>
              
              
                                <ion-card-content>
                                  <ion-skeleton-text [animated]="true" style="height: 100px;"></ion-skeleton-text>
                                </ion-card-content>
              
                                <ion-row class="ion-padding-horizontal">
                                  <ng-container  *ngFor="let key of [1,2,3]">
                                    <ion-col size="4" class="ion-align-self-center ion-justify-content-center">
                                      <ion-skeleton-text [animated]="true" style="height: 80px;"></ion-skeleton-text>
                                    </ion-col>             
                                  </ng-container> 
                                </ion-row>
                                
                              </ion-card>
                              
                            </ng-container>
                          </ng-container>
              
                          <ng-container *ngIf="vkGroupPostsLoaded">
                            <ng-container *ngFor="let post of vkGroupPosts.items; let i = index">
                              <ion-card *ngIf="!post.copy_history">
                                <ng-container *ngIf="vkGroupPosts.profiles">
                                <ng-container *ngFor="let profile of vkGroupPosts.profiles; index as i" class="card-profile">
                                  <ion-item *ngIf="i === 0" class="ion-margin-end">
                                    <ion-avatar slot="start">
                                      <img alt="ava" src="{{ profile.photo_50 }}" />
                                    </ion-avatar>
                                    <ion-label>{{ profile.first_name }}</ion-label>
                                  </ion-item>
                                </ng-container>
                                </ng-container>
                                
                                <ion-card-content *ngIf="post.text">
                                  <app-read-more text="{{ post.text }}"></app-read-more>
                                </ion-card-content>
                                <!-- Фото во вложении -->
                                <swiper-container 
                                  #swiper
                                  autoplay="true"
                                  autoplay-delay="5000"
                                  autoplay-disableOnInteraction="false"
                                  navigation="true"
                                  [pagination]="true"
                                  [grabCursor]="true"
                                  [zoom]="false"
                                  [slidesPerView]="1"
                                  [centeredSlides]="true"
                                  [followFinger]="true" 
                                  [loop]="true" 
                                  [initialSlide]="0"  
                                  *ngIf="post.attachments" class="card-container-content">
                                  <ng-container *ngFor="let attachment of post.attachments">
                                    <ng-container *ngIf="attachment.photo" >
                                      <ng-container *ngFor="let photo of attachment.photo.sizes">
                                        <swiper-slide *ngIf="photo.type === 'x'">
                                          <a href="{{photo.url}}" target="_blank"><img alt="ava" [src]="photo.url"/></a>
                                        </swiper-slide>
                                      </ng-container>
                                    </ng-container> 
                                  </ng-container> 
                                </swiper-container>
              
                                <ng-container *ngIf="post.attachments" class="card-container-content">
                                  <ng-container *ngFor="let attachment of post.attachments">
                                    <!-- Видео во вложении -->
                                    <ng-container *ngIf="attachment.video" >
                                      <ion-col class="video_col">
                                            <span class="video-title">{{ attachment.video.title }}</span>
                                            <iframe class="video_content" [src]="attachment.video.owner_id | safeVideoById:attachment.video.id" allow="autoplay; fullscreen; picture-in-picture;" frameborder="0" allowfullscreen width="100%" height="100%"></iframe>
                                            <p>Описание видео: </p>
                                            <app-read-more *ngIf="attachment.video.description" text="{{ attachment.video.description }}"></app-read-more>
                                        </ion-col>    
                                    </ng-container>
              
                                    <!-- Ссылки во вложении -->
                                    <ion-card ng-container *ngIf="attachment.link">
                                      <ion-item button detail="true" href="{{ attachment.link.url }}" *ngIf="attachment.link">
                                        <ion-thumbnail  slot="start">
                                            <img class="imgPost" src="{{attachment.link.photo.sizes[1].url}}"/>
                                        </ion-thumbnail>
                                        <ion-label>
                                          <h3>{{ attachment.link.title }}</h3>
                                          <p>{{attachment.link.caption}}</p>
                                        </ion-label>
                                      </ion-item>
                                    </ion-card>
                                  </ng-container>
                                </ng-container>
                                
                                <ion-footer>
                                  <div class="ion-text-end">
                                    <ion-button (click)="closeAllModals()" (click)="selectedVkGroupPost(post)" class="ion-margin" [color]="vkGroupPostSelected?.id === post.id ? 'success' : 'medium'">
                                      <ion-icon  *ngIf="vkGroupPostSelected?.id === post.id" name="checkmark-outline" slot="start"></ion-icon>
                                      {{ vkGroupPostSelected?.id === post.id ? 'Выбрано' : 'Выбрать'}} 
                                    </ion-button>
                                  </div>  
                                </ion-footer>
                              </ion-card>
                              
                            </ng-container>
                          </ng-container>
                        </div>
                        
                        <ng-template #notSelectedGroup>
                          <ion-row>
                            <ion-list-header>
                              <ion-note color="medium" class="ion-padding-vertical">Вы не выбрали группу, для выбора вернитесь назад и выберите группу (шаг 1)</ion-note>
                            </ion-list-header>
                          </ion-row>
                        </ng-template>


                      </ion-content>
                  </ng-template>

        </ion-modal>



        <!-- <div class="openModalBtnWraper">
          <ion-button class="openModalBtn" style="--border-radius:8px;" (click)="openModalGroup()" class="selectGroup">
            <ion-icon style="margin-right: 1vh;"  name='logo-vk'></ion-icon>
            Загрузить пост
          </ion-button>
        </div> -->
        <ion-column class="stepThird ion-justify-content-center">

          <ion-col @fade>



            <div class="BtnModalParrent " style="display: flex; align-items: center;">
                        
              <ion-button class="openModalBtn" style="--border-radius:8px;" (click)="openModalGroup()" class="selectGroup">
                <ion-icon style="margin-right: 1vh;"  name='logo-vk'></ion-icon>
                Загрузить из поста
              </ion-button>

              <div class="descriptionButton">
                вы можете загрузить описание и изображения из группы вконтакте
              </div>

            </div>

            <ion-column class="timeAndDescription">



             
             
          

              <div class="descriptionParrent">

                

                    <ion-col style="width: 80%;" *ngIf="stepCurrency === 2" @fade>
                      
                      
                      <ion-item style="width: 60vh;" fill="outline">
                     
                        <ion-label position="stacked">Об мероприятии</ion-label>
                   
                        <ion-textarea 
                        
                          formControlName="description" 
                          placeholder="Введите информацию об мероприятии.." 
                          [autoGrow]="true" 
                        
                          style="padding-bottom: 8vh;"
                          
                        >

                       

                      </ion-textarea>


                            <div class="ion-margin-vertical">
                              <!-- Image Preview -->
                              <ion-row  *ngIf="imagesPreview">
                  
                                <ng-container *ngFor="let img of imagesPreview">
                                  <ion-col class="imagesPreviewParrent ion-justify-content-center">
                                    <img class="imagesPreview" [src]="img" alt="preview">
                  
                                    <ion-button class="deletPrewviewButton" color="danger" expand="block" (click)="deleteFile(img)">
                                      <ion-icon name="trash-bin" slot="start"></ion-icon>
                                    </ion-button>
                  
                                  </ion-col>    
                                </ng-container>    
                              </ion-row>

                              <ion-row *ngIf="vkGroups && vkGroupPostSelected && vkGroupPostSelected.attachments.length" class="ion-padding-horizontal">
                                <ng-container  *ngFor="let attachment of vkGroupPostSelected.attachments">
                                  <ng-container *ngFor="let photo of attachment.photo.sizes">
                                    <ion-col class="" *ngIf="photo.type === 'm'" size="4" class="ion-align-self-center ion-justify-content-center">
                                      <img class="imagesPreview" alt="ava" src="{{ photo.url }}" /> 
                                    </ion-col>     
                                  </ng-container>  
                                </ng-container> 
                              </ion-row>
                            </div>
                       

                          <ion-item style="border-top: 1px solid rgba(85, 84, 84, 0.226);">

                            <ion-button  (click)="filesUpload.click()" style="--background: none; --box-shadow: none;" class="addPhoto">
                              <ion-icon class="addPhotoIcon" style="color: gray;" name="image-outline"></ion-icon>
                            </ion-button>
                          </ion-item>

                      </ion-item>
                    
                 



                        <input formControlName="files" (change)="onFileChange($event)" type="file" name="files[]" accept="image/png, image/jpeg" hidden multiple #filesUpload>
                        <ion-note *ngIf="createEventForm.controls['files'].hasError('requiredFileType')" color="danger">Допустимые форматы *.png, *.jpeg</ion-note>

                  
                       

                      <div *ngIf="createEventForm.controls['description'].invalid && createEventForm.controls['description'].dirty"  class="validation">
                        <ion-note *ngIf="!createEventForm.controls['description'].hasError('minLength')" color="danger">поле "Об мероприятии" должно содержать минимум 10 символов</ion-note>
                      </div>
                      <!-- <div *ngIf="createEventForm.controls['description'].invalid && createEventForm.controls['description'].dirty "  class="validation">
                        <ion-note *ngIf="!createEventForm.controls['description'].hasError('minLength')" color="danger">поле "Об мероприятии" должно содержать минимум 10 символа</ion-note>
                      </div> -->
                    </ion-col>

              </div>

              

            </ion-column>


            <ion-col class="photoMain"  @fade>
              <!-- <ion-label position="floating">Добавление фотографий (*.png, *.jpeg)</ion-label> -->
              
      
    
              <ion-row *ngIf="vkGroups && vkGroupPostSelected && !vkGroupPostSelected.attachments.length" class="ion-padding-vertical">
                <ion-col class="ion-align-self-center ion-justify-content-center">
                  <ion-label color="medium">В выбранном посте нету фотографий</ion-label>
                </ion-col> 
              </ion-row>
    
              <!-- <ion-row *ngIf="vkGroups && !vkGroupPostSelected" class="ion-padding-vertical">
                <ion-col class="ion-align-self-center ion-justify-content-center">
                  <ion-label color="medium">Вы не выбрали пост, невозможно подгрузить фотографии</ion-label>
                </ion-col> 
              </ion-row> -->
            </ion-col>
            
            <ion-column>


              <div class="timeParrent">

               
               <div class="dateFirst">
                  <ion-list-header><ion-label>Начало мероприятия: </ion-label></ion-list-header>
                  <ion-datetime-button 
                    datetime="eventStart" 
                  ></ion-datetime-button>
        
                  <ion-modal [keepContentsMounted]="true">
                    <ng-template>
                      <ion-datetime 
                        id="eventStart" 
                        [firstDayOfWeek]="1" 
                        [showDefaultButtons]="true"
                        doneText="Ok"
                        cancelText="Отмена"
                        locale="ru-RU"
                        formControlName="dateStart"
                        ></ion-datetime>
                    </ng-template>
                  </ion-modal>
               </div>
               

               <div class="dateLast">

                <ion-list-header><ion-label>Конец мероприятия: </ion-label></ion-list-header>
      
                <ion-datetime-button 
                  datetime="eventEnd" 
                >

              </ion-datetime-button> 
                <ion-modal [keepContentsMounted]="true">
                  <ng-template>
                    <ion-datetime 
                      id="eventEnd"  
                      [firstDayOfWeek]="1" 
                      [showDefaultButtons]="true"
                      doneText="Ok"
                      cancelText="Отмена"
                      locale="ru-RU"
                      formControlName="dateEnd"
                    ></ion-datetime>
                  </ng-template>
                </ion-modal>
               </div>
              

              </div>

           

            </ion-column>

            <div  style="max-width: 60vh;" *ngIf="createEventForm.hasError('dateInvalid')">
              <ion-note color="danger">Дата начала не может быть позднее даты конца, а дата конца не может быть раньше даты начала.</ion-note>
            </div>

            <div  style="max-width: 60vh;" *ngIf="!dataValid">
              <ion-note color="danger">Минимальная длительность мероприятия 15 минут!</ion-note>
            </div>

          </ion-col>
          



          

        </ion-column>

        
       
      </ion-row>
            
      <!-- шаг 4 -->
      <ion-row  [hidden]="stepCurrency !== 3" class="ion-justify-content-center">
        <!-- <ion-button (click)="searchMinSeans()">test</ion-button> -->
        <ion-col *ngIf="stepCurrency === 3" @fade>
          <ion-list-header>
            <ion-label>На карте выберите место проведения мероприятия</ion-label>
          </ion-list-header>
            <ion-row class="place-list">
              <ng-container *ngFor="let array of placeArrayForm; let i = index">
                <ion-card [formGroup]="createEventForm.controls['places'].value[i]">
                  <ion-card-header>
                   
                    <ion-row>
                        <ion-item disabled="true"  style="width: 100%;" fill="" class="" >
                          <ion-icon name="earth" slot="start"  size="small" color="primary"></ion-icon>
                          <ion-input  fill="outline"  required formControlName="address" (ionChange)="clearSearche($event, i)" placeholder="Адрес мероприятия..." id="{{'search-map-'+i}}" type="text" name="search" required></ion-input>
                        </ion-item>
              
                      </ion-row>
                 
                 
                  </ion-card-header>
                  <ion-card-content>
                  <ion-list>
                      <!-- Город мероприятия -->
                      <ion-col>
                        <p>Выбран:</p><span>{{array.city}} </span>,<span> {{array.region}}</span>
                      <div class="ion-padding" >
                        <ion-searchbar animated="true" placeholder="Найти город..." (ionChange)="getCityes($event)" (ionClear)="onClearSearch()"  debounce="500" #cityesSearchbar></ion-searchbar>
                        <ion-note *ngIf="minLengthCityesListError" color="danger" class="ion-padding-horizontal">минимум 3 символа</ion-note>
                          <ng-container *ngIf="cityesListLoading">
                              <ion-list class="ion-padding-end">
                                  <ion-item *ngFor="let key of [1,2,3]">
                                      <ion-skeleton-text [animated]="true" style="height: 0.5rem;" />
                                  </ion-item>
                              </ion-list>
                          </ng-container>
                          <!-- <ion-item lines="none" *ngIf="!cityesListLoading && !cityesList.length">
                              <ion-lable><h3>Город не найден...</h3></ion-lable>
                          </ion-item> -->
                          <ion-list *ngIf="!cityesListLoading">
                            <ion-item *ngFor="let item of cityesList" (click)="setCityes(item, i)" class="search-item" [hidden]="item.location_parent.name === 'РФ'">
                              <ion-label>
                                  <h2>{{ item.name }}</h2>
                                  <p>{{ item.location_parent.name }}</p>
                              </ion-label>
                            </ion-item>
                          </ion-list>
                      </div>
                      </ion-col>
                      <ion-col>
                        <p>Выбран:</p><span>{{array.sight_name}}</span>
                      <div class="ion-padding" >
                        <ion-searchbar animated="true" placeholder="Найти достопримечательность..." (ionChange)="getSight($event, i)" (ionClear)="onClearSearch()"  debounce="500" #sightSearchbar></ion-searchbar>
                        <ion-note *ngIf="minLengthCityesListError" color="danger" class="ion-padding-horizontal">минимум 3 символа</ion-note>
                          <ng-container *ngIf="sightsListLoading">
                              <ion-list class="ion-padding-end">
                                  <ion-item *ngFor="let key of [1,2,3]">
                                      <ion-skeleton-text [animated]="true" style="height: 0.5rem;" />
                                  </ion-item>
                              </ion-list>
                          </ng-container>
                          <!-- <ion-item lines="none" *ngIf="!sightsListLoading && !cityesList.length">
                              <ion-lable><h3>Город не найден...</h3></ion-lable>
                          </ion-item> -->
                          <ion-list *ngIf="!sightsListLoading">
                            <ion-item *ngFor="let item of sightsList" (click)="setSight(item, i)" class="search-item">
                              <ion-item>
                                <ion-thumbnail slot="start">
                                  <img alt="Silhouette of mountains" src="{{item.files[0].link}}" />
                                </ion-thumbnail>
                                <ion-label>
                                  <h2>{{ item.name }}</h2>
                                  <p>{{ item.address }}</p>
                                  <!-- <p>Автор: {{item.author.name}}</p> -->
                                </ion-label>
                              </ion-item>
                            </ion-item>
                          </ion-list>
                      </div>
                      </ion-col>

                    <!-- Поиск не работает, сломан -->
                  
                    
                    <ion-item >
                      <div class="map ">
                        <ya-map (ready)="onMapReady($event, i)" 
                          [zoom]="11"
                          (yaclick)="onMapClick($event, i)"
                          [center]="this.createEventForm.controls['places'].value[i].coords"
                          [state]="{
                            controls: [
                              'zoomControl',
                              'fullscreenControl',]
                            }" 
                        >
                        </ya-map>
                      </div>
                    </ion-item>
                    
                    <ion-item *ngFor="let sean of array.seances;  let i_s = index" lines="none">
                    <!-- Создание сеансов -->
                      <ion-card [formGroup]="createEventForm.controls['places'].value[i].value.seances[i_s]" class="list-seances">
                        <ion-card-header lines="none">
                          <ion-item lines="none">
                          <ion-row>
                            <ion-item lines="none">
                              <ion-label><h2>Сеанс {{i_s+1}}</h2></ion-label>
                            </ion-item>
                            <ion-item lines="none">
                              <ion-chip color="danger" (click)="deleteSeanceForm(i, i_s)">Удалить
                                <!-- <ion-icon name="close-outline"></ion-icon> -->
                              </ion-chip>
                            </ion-item>
                          </ion-row>
                          </ion-item>
                        </ion-card-header>
                          
                          <ion-list-header><ion-label>Начало сеанса: </ion-label></ion-list-header>
                          <ion-datetime-button 
                            datetime="{{'eventStart-'+i+'-'+i_s}}" 
                            class="ion-margin-vertical"
                          ></ion-datetime-button>

                          
                          <ion-modal [keepContentsMounted]="true">
                            <ng-template>
                              <ion-datetime 
                                id="{{'eventStart-'+i+'-'+i_s}}" 
                                [firstDayOfWeek]="1" 
                                [showDefaultButtons]="true"
                                doneText="Ok"
                                cancelText="Отмена"
                                locale="ru-RU"
                                formControlName="dateStart"
                                ></ion-datetime>
                            </ng-template>
                          </ion-modal>

                          <div *ngIf="createEventForm.hasError('dateInvalid')">
                            <ion-note color="danger">Дата начала не может быть позднее даты конца, а дата конца не может быть раньше даты начала</ion-note>
                          </div>
                          
                          <ion-list-header><ion-label>Конец сеанса: </ion-label></ion-list-header>
                
                          <ion-datetime-button 
                            datetime="{{'eventEnd-'+i+'-'+i_s}}" 
                            class="ion-margin-vertical"
                          ></ion-datetime-button>
                
                          <ion-modal [keepContentsMounted]="true">
                            <ng-template>
                              <ion-datetime 
                                id="{{'eventEnd-'+i+'-'+i_s}}" 
                                [firstDayOfWeek]="1" 
                                [showDefaultButtons]="true"
                                doneText="Ok"
                                cancelText="Отмена"
                                locale="ru-RU"
                                formControlName="dateEnd"
                              ></ion-datetime>
                            </ng-template>
                          </ion-modal>
                      </ion-card>
                    </ion-item>
                    <ion-chip color="primary" class="ion-justify-item-center" (click)="addSeances(i)">
                      <ion-label>Добавить сеанс</ion-label>
                      <ion-icon name="add-outline"></ion-icon>
                    </ion-chip>
                    <ion-item>
                      <!-- Достопримечательность в котором проходит мероприятие -->
                    </ion-item>
                  </ion-list>
                  </ion-card-content>

                  <ion-card-footer>

                  </ion-card-footer>
                </ion-card>
              </ng-container>
              <ion-chip color="primary" class="ion-justify-item-center" (click)="addPlaceForm()">
                <ion-label>Добавить место проведения</ion-label>
                <ion-icon name="add-outline"></ion-icon>
              </ion-chip>
            </ion-row>
          </ion-col>
      </ion-row>
      
      <!-- шаг 5 -->
      <ion-row  [hidden]="stepCurrency !== 4" style="max-width: 60%; display: flex; margin: 0 auto;">
        <ion-col *ngIf="stepCurrency === 4" class="ion-justify-content-center" @fade>
          <ion-card *ngFor="let item of createEventForm.controls['price'].value; let i_p = index">
            <ng-container [formGroup]="createEventForm.controls['price'].value[i_p]">
              <ion-card-hider>
                <ion-item>
                  <ion-icon name="pricetag-outline" color="primary"></ion-icon>
                  <ion-label>
                    <h1> Цена {{i_p+1}}</h1>
                  </ion-label>
                  <ion-item lines="none">
                    <ion-chip color="danger" (click)="deletePrice(i_p)">Удалить
                      <!-- <ion-icon name="close-outline"></ion-icon> -->
                    </ion-chip>
                  </ion-item>
                </ion-item>
              </ion-card-hider>
              <ion-item>
                <ion-label position="floating">Стоимость</ion-label>
                <ion-icon name="text-outline" slot="start"  size="small" color="primary"></ion-icon>
                <ion-input formControlName="cors_rub" type="number" name="price"></ion-input>
              </ion-item>
              <ion-item>
                <ion-label position="floating">Описание</ion-label>
                <ion-icon name="text-outline" slot="start"  size="small" color="primary"></ion-icon>
                <ion-textarea formControlName="description" type="text" name="price"></ion-textarea>
              </ion-item>
            </ng-container>
          </ion-card>
          <ion-chip style="margin-bottom: 2rem;" color="primary" class="ion-justify-item-center" (click)="addPrice()">
            <ion-label>Добавить цену</ion-label>
            <ion-icon name="add-outline"></ion-icon>
          </ion-chip>


          
          <ion-col style="margin-top: 15px;" size-lg="4" size-md="8" size-xs="12" @fade>
            <ion-item fill="outline">
              <ion-label position="floating" class="position-label-inside">Доп. материалы</ion-label>
              <ion-textarea formControlName="materials" placeholder="Cсылки на фото, пост вк, оплату билетов и.т.д..." [autoGrow]="true"></ion-textarea>
            </ion-item>
          </ion-col>
     


            <ion-col >
              <ion-list>
                <ion-radio-group formControlName="status" (ionChange)="selectedStatus($event)" [value]="statusSelected" required>
                  <ng-container *ngIf="!statusesLoaded">
                    <ng-container *ngFor="let key of [1,2,3,4,5]">
                      <ion-item>
                        <ion-avatar>
                          <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                        </ion-avatar>
                        <ion-label class="ion-padding-start">
                          <ion-skeleton-text [animated]="true"></ion-skeleton-text>
                        </ion-label>
                      </ion-item>
                    </ng-container>
                  </ng-container>
    
                  <ng-container *ngIf="statusesLoaded">
                    <ng-container *ngFor="let status of statuses">
                      <ion-item *ngIf="status.name === 'На модерации'">
                        <ion-icon name="checkmark-done" slot="start" color="success" size="large"></ion-icon>
                        <ion-label>Отправить на модерацию</ion-label>
                        <ion-radio slot="end" [value]="status.id"></ion-radio>
                      </ion-item>
                      
                      <ion-item *ngIf="status.name === 'Черновик'">
                        <ion-icon name="create" slot="start" color="medium" size="large"></ion-icon>
                        <ion-label>Оставить в черновиках</ion-label>
                        <ion-radio slot="end" [value]="status.id"></ion-radio>
                      </ion-item>
                    </ng-container>
                  </ng-container>
                  
                </ion-radio-group>
              </ion-list>
            </ion-col>
        </ion-col>
      </ion-row>
      
    

       <!-- Десктопный блок кнопок -->
      

      <!-- Фиксированный блок кнопок для мобилы-->
      <div class="buttons-mobile">
        <ion-row class="ion-justify-content-center">
          <ion-col size="6">
            <ion-button *ngIf="stepCurrency !== stepStart"  (click)="stepPrev()" expand="block"><ion-icon name="chevron-back" slot="start"></ion-icon>Назад</ion-button>
          </ion-col>
          <ion-col size="6">
            <ion-button *ngIf="stepCurrency !== steps"  (click)="stepNext()" expand="block">Далее <ion-icon name="chevron-forward" slot="end"></ion-icon></ion-button>
            <ion-button *ngIf="stepCurrency === steps" type="submit" [disabled] ="createEventForm.invalid || createEventForm.disabled" expand="block"><ion-icon name="checkmark-done-outline" slot="start"></ion-icon>Готово</ion-button>
          </ion-col>     
        </ion-row>
      </div>

    </form>
  </ion-grid>

</ion-content>