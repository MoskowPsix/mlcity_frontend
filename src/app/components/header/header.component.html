<ion-header class="header-mobile" id="header-m">
    <ion-toolbar>
        <!-- <ion-buttons slot="end">
            <ion-menu-toggle>
                <ion-button>
                    <ion-icon slot="icon-only" name="menu"></ion-icon>
                </ion-button>
            </ion-menu-toggle>
        </ion-buttons> -->
        <ion-row>
            <!-- <ion-col>
                <ion-title *ngIf="!showBackButton">
                    <div class="logo">
                        <img src="assets/icons/favicon.png">
                        <span>{{ appName }}</span>
                    </div>
                </ion-title>
            </ion-col> -->
            <ion-col *ngIf="showBackButton" size="auto">
                <ion-icon  name="chevron-back" size="large" color="primary" appBackButton></ion-icon>
            </ion-col>

            <ion-col class="ion-align-self-start">
                <ion-button fill="clear" size="small" color="dark" (click)="isModalSearchCityesOpen(true)">
                    {{ city| truncate:[20,'']}}...
                    <!-- <ion-icon name="location" color="primary"></ion-icon> -->
                    <!-- <ion-label>+{{ radius }}км</ion-label> -->
                    <ion-icon slot="end" name="chevron-down"></ion-icon>
                </ion-button>
            </ion-col>

            <ion-col class="flex ion-justify-content-end ion-padding-horizontal z-index-9999">
                <!-- <ion-searchbar animated="true" placeholder="Поиск"></ion-searchbar> -->
                <ion-icon name="search" color="medium" size="large" class="ico" (click)="isModalSearchEventsOpen(true)"></ion-icon>
            </ion-col>
        </ion-row>
    </ion-toolbar>
</ion-header>

<!-- Декстопное меню -->
<ion-div class="header ion-align-items-center" id="header">
    <ion-router-link color="dark" routerLink="/home">
        <ion-col size="auto" class="logo">
            <img  src="assets/icons/favicon.png">
            <span >{{ appName }}</span>
        </ion-col>
    </ion-router-link>

    <ion-col style="margin-left: 3px;" size="auto" class="cityButton ion-padding-horizontal ion-align-self-center">
        <ion-button fill="clear" size="small" color="dark" (click)="isModalSearchCityesOpen(true)">
            {{ city| truncate:[20,'']}}...
            <!-- <ion-icon name="location" color="primary"></ion-icon> -->
            <!-- <ion-label>+{{ radius }}км</ion-label> -->
            <ion-icon slot="end" name="chevron-down"></ion-icon>
        </ion-button>
    </ion-col>

     <ion-col style="padding-right: 3px;" class="searchParrent ion-padding-horizontal">
        <!-- <ion-searchbar placeholder="Поиск" color="light" (click)="isModalSearchEventsOpen(true)"></ion-searchbar> -->
         <ion-button style="min-width: 80px; display: flex; justify-content: center; "  fill="outline" expand="block" (click)="isModalSearchEventsOpen(true)" class="SearchInput"><ion-icon style="width: 20px; height: 20px; --font-size: 20px;" name="search" slot="start"></ion-icon>поиск</ion-button>
    </ion-col>

    <ion-col  size="auto" class="menu ion-align-items-center">
        <div *ngFor="let item of menuPublic">
            <app-dropdown-popup
                *ngIf="item.children?.length > 0;  else itemMenu"
                [id]="'publicMenu'"
                [headerLeftIco]="true"
                [headerLeftIcoName]="'call'"
                [headertitle]="item.title"
                [listItems]="[item]"
                [itemIco]="true"
            >
            </app-dropdown-popup>

            <ng-template #itemMenu>
                <ion-button
                    fill="clear"
                    color="dark"
                    [routerLink]="[item.route]"
                    [routerLinkActive]="['active']"
                >
                    <ion-icon name="{{ item.icon }}" slot="start" color="primary"></ion-icon>
                    <ion-label slot="start">{{item.title}}</ion-label>
                    <!-- <ion-badge *ngIf="item.title === 'События'" slot="end" >{{ getEventService() }}</ion-badge>
                    <ion-badge *ngIf="item.title === 'Места'" slot="end" >{{ getSightService() }}</ion-badge> -->
                </ion-button>

            </ng-template>
        </div>
        <app-menu-auth></app-menu-auth>
    </ion-col>

    <!-- <ion-col class="auth">
        <app-menu-auth></app-menu-auth>
    </ion-col> -->
</ion-div>


<!-- Диалог подтверждения города -->
<ion-popover [isOpen]="showChangeCityDialog" (didDismiss)="!showChangeCityDialog" showBackdrop="false" arrow="true">
    <ng-template>
        <div class="city-popover">
            <div class="title">
                <ion-label>Возможно ваш город {{ geolocationCity }}, {{ geolocationRegion }}?</ion-label>
            </div>
            <div class="buttons">
                <ion-button size="small" fill="outline" (click)="hideCityDialog()">
                    нет
                </ion-button>
                <ion-button size="small" (click)="setCityFromDialog()">
                    Да
                    <ion-icon name="checkmark" slot="end"></ion-icon>
                </ion-button>
            </div>
        </div>
    </ng-template>
</ion-popover>


  <!-- Модальное окно для выбора города -->
<ion-modal [isOpen]="modalSearchCityesOpen" (ionModalDidDismiss)="modalClose()">
    <ng-template>
        <ion-header>
            <ion-toolbar>
                <ion-title>Выбор города</ion-title>
                <ion-buttons slot="end">
                    <ion-button (click)="isModalSearchCityesOpen(false)"><ion-icon name="close"></ion-icon></ion-button>
                </ion-buttons>
            </ion-toolbar>
        </ion-header>
        <ion-note color="primary" class="ion-padding-horizontal ion-padding-top">Текущий город: {{ city }}, {{ region }}</ion-note>

        <!-- <div class="ion-padding-bottom" slot="content">
            <ion-range
             [ticks]="true"
             [snaps]="true"
             [min]="1"
             [max]="25"
             [pin]="true"
             [value]="radius"
             [pinFormatter]="pinRadiusFormatter"
             (ionKnobMoveEnd)="radiusChange($event)"
            ></ion-range>
            <ion-label class="ion-padding-horizontal">Радиус поиска: {{ radius }} км.</ion-label>
        </div> -->

        <ion-searchbar animated="true" placeholder="Введите текст..." [formControl]="searchCityes" (ionChange)="getCityes($event)" (ionClear)="onClearSearch()"  debounce="500" #cityesSearchbar></ion-searchbar>
        <ion-note *ngIf="minLengthCityesListError" color="danger" class="ion-padding-horizontal">минимум 3 символа</ion-note>
        <ion-content>
            <ng-container *ngIf="cityesListLoading">
                <ion-list class="ion-padding-end">
                    <ion-item *ngFor="let key of [1,2,3,4,5,6,7,8,9,10]">
                        <ion-skeleton-text [animated]="true" style="height: 1rem;" />
                    </ion-item>
                </ion-list>
            </ng-container>
            <ng-container *ngIf="!cityesListLoading && !cityesList.length">
                <app-no-data />
            </ng-container>
            <ion-list>
              <ion-item *ngFor="let item of cityesList; let i = index" (click)="onSelectedCity(item)" class="search-item">
                <ion-label>
                    {{ item.name }}<p>{{ item.location_parent.name }}</p>
                </ion-label>
              </ion-item>
            </ion-list>
          </ion-content>
    </ng-template>
</ion-modal>

  <!-- Модальное окно для поиска ивентов -->
  <ion-modal [isOpen]="modalSearchEventsOpen" (ionModalDidDismiss)="modalClose()">
    <ng-template>
        <ion-header>
            <ion-toolbar>
                <ion-title>Поиск мест и событий</ion-title>
                <ion-buttons slot="end">
                    <ion-button (click)="isModalSearchEventsOpen(false)"><ion-icon name="close"></ion-icon></ion-button>
                </ion-buttons>
            </ion-toolbar>
        </ion-header>
        <!-- <ion-note color="primary" class="ion-padding-horizontal ion-padding-top">Поиск по: {{ city }}, {{ region }}</ion-note> -->
        <ion-searchbar animated="true" placeholder="Введите текст..." [formControl]="searchEvents" (ionChange)="getEventsAndSights($event)" (ionClear)="onClearSearch()" debounce="500"></ion-searchbar>
        <ion-note *ngIf="minLengthEventsListError" color="danger" class="ion-padding-horizontal">минимум 3 символа</ion-note>
        <ng-container *ngIf="!eventsListLoading && !sightsListLoading && (eventsList.length || sightsList.length)">
            <div class="ion-margin-horizontal">
                <ion-segment value="events" color="primary" (ionChange)="onSegmentChanged($event)">
                    <ion-segment-button value="events">
                        <ion-label>Мероприятия</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="sights">
                        <ion-label>Достопримечательности</ion-label>
                    </ion-segment-button>
                </ion-segment>
            </div>
        </ng-container>
        <ion-content class="ion-padding">
            <ng-container *ngIf="eventsListLoading || sightsListLoading">
                <ion-list class="ion-padding-end">
                    <ion-card *ngFor="let key of [1,2,3,4,5]">
                        <ion-skeleton-text [animated]="true" style="height: 1rem; width: 80%;  margin: 0.5rem;" />
                        <ion-skeleton-text [animated]="true" style="height: 10em; margin: 0.5rem 0;" />
                        <ion-skeleton-text [animated]="true" style="height: 1rem; width: 95%; margin: 0.5rem;" />
                        <ion-skeleton-text [animated]="true" style="height: 1rem; width: 95%; margin: 0.5rem;" />
                        <ion-skeleton-text [animated]="true" style="height: 1rem; width: 80%; margin: 0.5rem;" />
                    </ion-card>
                </ion-list>
            </ng-container>

            <ng-container *ngIf="!eventsListLoading && !sightsListLoading && !eventsList.length && !sightsList.length">
                <app-no-data />
            </ng-container>

            <ng-container *ngIf="!eventsListLoading  && !sightsListLoading && (eventsList.length || sightsList.length)">
                <ng-container *ngIf="segment === 'events'">
                    <ng-container *ngIf="eventsList.length">
                        <ion-row class="ion-justify-content-start">
                            <ion-col *ngFor="let event of eventsList; let i = index" size-md="6" size-xs="12">
                              <app-event-card [event]="event" [isSight]="false"></app-event-card>
                            </ion-col>
                        </ion-row>
                    </ng-container>
                    <ng-container *ngIf="!eventsList.length">
                        <app-no-data />
                    </ng-container>
                </ng-container>

                <ng-container *ngIf="segment === 'sights'">
                    <ng-container *ngIf="sightsList.length">
                        <ion-row class="ion-justify-content-start">
                            <ion-col *ngFor="let sight of sightsList; let i = index" size-md="6" size-xs="12">
                              <app-event-card [event]="sight" [isSight]="true"></app-event-card>
                            </ion-col>
                        </ion-row>
                    </ng-container>
                    <ng-container *ngIf="!sightsList.length">
                        <app-no-data />
                    </ng-container>
                </ng-container>
                <!-- <ng-container #noData>
                    <app-no-data />
                </ng-container> -->
            </ng-container>



          </ion-content>
    </ng-template>
</ion-modal>
